# 14단계 Implementation Plan: 분산형 개인 드라이브 저장 아키텍처 (Personal Drive Migration)

> **최종 작성일**: 2026-02-23  
> **목표**: 중앙 집중식 저장 방식에서 벗어나, 팀원 개인이 자신의 데이터를 소유하고 관리하는 분산형 아키텍처 구축

---

## 1. 도입 배경 및 필요성

### ❌ 현재 방식: 중앙 집중식 저장 (Master Root Folder)
- **구조**: 모든 팀원의 메모가 시스템 관리자 계정의 특정 폴더(`ARCHIVE_ROOT_FOLDER_ID`) 하위에 저장됨.
- **문제점**:
  - **데이터 소유권**: 팀원의 업무 기록이 관리자 드라이브에 종속됨.
  - **보안 리스크**: 관리자 계정 탈취 시 모든 팀원의 데이터가 노출됨.
  - **용량 제한**: 관리자 1인의 드라이브 용량을 모든 팀원이 공유하여 사용하게 됨.

### ✅ 새로운 해법: 분산형 개인 드라이브 (Personal Drive Sync)
- **개념**: 팀원 개개인의 '내 드라이브(My Drive)'에 전용 저장 공간을 확보하고, 시스템은 해당 공간에 대한 '편집 권한'만 위임받아 동작함.
- **장점**:
  - 팀원 개인이 데이터의 실질적 소유권을 가짐.
  - 각자의 드라이브 용량을 최대로 활용 가능.
  - 데이터 주권 및 개인정보 보호 강화.

---

## 2. 상세 구현 프로세스 (4단계)

### Step 1. 전용 폴더 자동 생성 및 권한 위임 로직
- **동작**: 유저가 주디 노트 웹앱 최초 진입 시(또는 설정 메뉴 진입 시) 실행.
- **로직**:
  1. 유저의 드라이브에 `공도_주디노트_저장소` 폴더가 있는지 검색.
  2. 없을 경우 폴더를 신규 생성.
  3. **핵심**: 시스템 관리자 이메일(또는 서비스 계정)을 해당 폴더의 '편집자'로 자동 초대하여, 배경 작업(자동 저장 등)이 가능하도록 권한 위임.

### Step 2. 유저별 폴더 ID 매핑 시스템 (Mapping Table)
- **저장소**: `PropertiesService` (Script Properties) 또는 별도의 `UserConfig` 구글 시트 활용.
- **내용**: `유저 이메일 : 개인 폴더 ID` 형태의 키-값 쌍 관리.
- **활용**: 슬랙에서 메시지 수신 시, 해당 유저의 이메일을 기반으로 매핑 테이블에서 폴더 ID를 즉시 조회.

### Step 3. 동적 저장 아키텍처 적용 (`drive_archive.gs` 개편)
- **기존**: `const ARCHIVE_ROOT_FOLDER_ID = "..."` 고정값 사용.
- **변경**:
  - `appendMemoToArchive` 호출 시 유저의 폴더 ID를 인자로 전달받거나 내부에서 조회.
  - 폴더 ID가 없을 경우 기존 루트 폴더를 Fallback으로 사용하거나 생성을 유도하는 안내 발송.

### Step 4. 데이터 마이그레이션 가이드 (Data Migration)
- **절차**:
  1. 기존 중앙 폴더에 쌓인 팀원별 폴더 및 파일(`.md`, 구글 문서) 확인.
  2. 개인별 폴더 생성 후, 기존 데이터를 각 유저의 새 폴더로 일괄 이동.
  3. 이동 완료 후 매핑 테이블 업데이트.

---

## 3. 기술적 고려 사항 (Technical Challenges)

- **OAuth 스코프**: 사용자의 드라이브에 접근하기 위해 `https://www.googleapis.com/auth/drive.file` 스코프 필요. 
- **UX 대응**: 이전에 기각되었던 '권한 승인 팝업' 이슈를 최소화하기 위해, **최초 1회만** 개인 설정을 통해 진행하게 하거나, 매직 링크 인증 과정에 자연스럽게 녹여내는 방안 검토 필요.
- **권한 회수**: 팀원이 퇴사하거나 서비스 이용 중단 시, 시스템 계정에 부여했던 폴더 권한을 스스로 회수할 수 있는 가이드 제공 필요.

---

## 4. 검증 시나리오 (Verification Plan)

1. 신규 유저가 접속했을 때, 해당 유저의 구글 드라이브에 폴더가 자동으로 생성되는가?
2. 생성된 폴더 내에 시스템 관리자가 접근 가능한지(공유 설정) 확인.
3. 슬랙으로 메모 전송 시, 관리자 드라이브가 아닌 **유저 개인 드라이브**의 파일에 내용이 업데이트되는가?
4. 기존에 작성했던 메모들을 개인 드라이브로 옮긴 후에도 웹 앱 사이드바에서 정상적으로 조회 가능한가?
