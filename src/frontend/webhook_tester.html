<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V4 í•‘í ì›¹í›… ì‹œë®¬ë ˆì´í„° (íŒ€ì¥ë‹˜ ì „ìš©)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100 h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden">
        <div class="bg-blue-600 p-6 text-white">
            <h1 class="text-xl font-bold flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                V4 í•‘í ì‹œìŠ¤í…œ ëª¨ì˜ í…ŒìŠ¤íŠ¸ê¸°
            </h1>
            <p class="text-blue-100 text-sm mt-2 opacity-90">í„°ë¯¸ë„ ì—†ì´ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ê°€ìƒì˜ "QA ë°˜ë ¤" ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="p-6 space-y-6">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">ì „ì†¡ ëŒ€ìƒ (Webhook URL)</label>
                <input type="text" readonly
                    value="https://script.google.com/macros/s/AKfycbx_4mNeMZm7MXA9LrYz1bDfd6u1hoCR8Asvj9L4V1-zeceyKIHV-TEXGwUWCeivmNmR/exec"
                    class="w-full bg-gray-50 border border-gray-300 text-gray-500 text-xs rounded-lg p-2.5 focus:outline-none">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">ì „ì†¡í•  ê°€ìƒ ë°ì´í„° (Payload)</label>
                <div class="bg-gray-800 rounded-lg p-3 overflow-auto">
                    <pre class="text-[11px] text-green-400 font-mono leading-relaxed">
{
  "task_id": "T-20260228-TEST",
  "action": "SUBMIT_QA",
  "qa_feedback": {
    "qa_status": "REJECTED",
    "pingpong_increment": true,
    "rejection_reason": "í…ŒìŠ¤íŠ¸: ë°±ì—”ë“œ íƒ€ì„ì•„ì›ƒ ë¯¸ì ìš©"
  },
  "used_tokens": 1500
}</pre>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œì°½ -->
            <div id="result-box" class="hidden rounded-lg p-4 text-sm font-medium border">
            </div>

            <button id="send-btn" onclick="sendWebhook()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex justify-center items-center transition-colors shadow-md">
                <span>ğŸš€ ê¹€ê°ì‚¬ "ë°˜ë ¤(REJECTED)" ë°ì´í„° ì˜ê¸°</span>
                <div id="loading" class="loader ml-3 hidden"></div>
            </button>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbx_4mNeMZm7MXA9LrYz1bDfd6u1hoCR8Asvj9L4V1-zeceyKIHV-TEXGwUWCeivmNmR/exec";
        const PAYLOAD = {
            task_id: "T-20260228-TEST",
            action: "SUBMIT_QA",
            qa_feedback: {
                qa_status: "REJECTED",
                pingpong_increment: true,
                rejection_reason: "í…ŒìŠ¤íŠ¸: ë°±ì—”ë“œ íƒ€ì„ì•„ì›ƒ ë¯¸ì ìš©"
            },
            used_tokens: 1500
        };

        async function sendWebhook() {
            const btn = document.getElementById('send-btn');
            const loading = document.getElementById('loading');
            const resultBox = document.getElementById('result-box');

            // ìƒíƒœ ì´ˆê¸°í™”
            btn.disabled = true;
            btn.classList.add('opacity-70');
            loading.classList.remove('hidden');
            resultBox.classList.add('hidden');
            resultBox.className = "rounded-lg p-4 text-sm font-medium border";

            try {
                // fetch: no-cors ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¸Œë¼ìš°ì € ë³´ì•ˆ ì´ìŠˆ(CORS)ë¥¼ ìš°íšŒí•˜ì—¬ ìš”ì²­ì„ ê°•ì œë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                // êµ¬ê¸€ Apps Script íŠ¹ì„±ìƒ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê°•ì œë¡œ ë˜ì ¸ì•¼ í•©ë‹ˆë‹¤.
                // ë‹¨, no-corsëŠ” ì‘ë‹µ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (Opaque ì‘ë‹µ)
                // ë”°ë¼ì„œ ë˜ì§€ëŠ” ì—­í• ë§Œ ìˆ˜í–‰í•˜ê³  ë¬´ì¡°ê±´ ì„±ê³µìœ¼ë¡œ ì·¨ê¸‰í•©ë‹ˆë‹¤.

                // Content-Typeì„ text/plainìœ¼ë¡œ ì†ì—¬ì„œ Preflight ì—ëŸ¬ë¥¼ í”¼í•˜ëŠ” íŠ¸ë¦­ì…ë‹ˆë‹¤. (GASëŠ” ì´ë¥¼ JSONìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥)
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(PAYLOAD)
                });

                // no-corsì´ë¯€ë¡œ response.okëŠ” falseë¡œ ë‚˜ì˜µë‹ˆë‹¤ë§Œ, ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šì•˜ë‹¤ë©´ ì „ì†¡ëœ ê²ƒì…ë‹ˆë‹¤.
                showResult(true, "âœ… ë°ì´í„° ì „ì†¡ ì„±ê³µ! (êµ¬ê¸€ ì‹œíŠ¸ì˜ ìƒíƒœê°€ ë³€í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”!)");

            } catch (error) {
                console.error("Fetch Error:", error);
                showResult(false, "âŒ ì „ì†¡ ì—ëŸ¬: " + error.message);
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-70');
                loading.classList.add('hidden');
            }
        }

        function showResult(isSuccess, message) {
            const resultBox = document.getElementById('result-box');
            resultBox.classList.remove('hidden');
            if (isSuccess) {
                resultBox.classList.add('bg-green-50', 'border-green-200', 'text-green-700');
            } else {
                resultBox.classList.add('bg-red-50', 'border-red-200', 'text-red-700');
            }
            resultBox.innerText = message;
        }
    </script>
</body>

</html>