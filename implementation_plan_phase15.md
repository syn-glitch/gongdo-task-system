# 15단계 Implementation Plan: 통합 지출 증빙 및 영수증 자동 파싱 (Expense & AI Parsing Integration)

> **최종 작성일**: 2026-02-24  
> **목표**: Cashflow 봇의 강력한 영수증/문자 파싱 기능을 Judy Ops로 통합하여 업무와 지출 관리를 단일화

---

## 1. 도입 배경

### ❌ 기존 방식: 파편화된 도구 사용
- **업무 관리**: Judy Ops (슬랙/웹)
- **지출 증빙**: Cashflow 봇 (별도 시스템)
- **문제점**: 사용자는 두 개의 봇을 번갈아 사용해야 하며, 지출 내역이 업무 태스크(지출결의 등)와 단절되어 있음.

### ✅ 통합 방향: Judy Intelligence Workspace
- Judy Ops 내에 '지출/영수증' 모듈을 통합하여, 결제 문자 전달 시 즉시 DB 저장 및 관련 태스크 자동 생성을 지원함.

---

## 2. 상세 구현 프로세스 (4단계)

### Step 1. AI 파싱 엔진 통합 (`ai_expense_parser.gs`)
- **기능**: Cashflow 봇의 Python 기반 파싱 로직을 GAS(Javascript) 환경에 맞게 이식하거나, API 형태로 연동.
- **내용**: 
  - 신한, 현대, 삼성 등 주요 카드사 결제 문자 패턴 인식.
  - Claude API(Vision)를 활용한 영수증 이미지 OCR 처리.
  - 금액, 가맹점, 일시, 승인번호 자동 추출.

### Step 2. 개인 드라이브 기반 영수증 아카이빙
- **연동**: 14단계(Personal Drive Migration) 아키텍처 활용.
- **로직**:
  - 유저별 개인 드라이브 내 `[Judy_Receipts]` 폴더 자동 생성.
  - 업로드된 영수증 이미지를 해당 폴더에 저장하고 접근 링크 생성.
  - 구글 시트 반영 시 이미지 링크를 함께 기록하여 증빙 편의성 제공.

### Step 3. 업무 연동 및 지출결의 자동화 (Task Linking)
- **핵심**: 지출 내역 저장 시 **"지출결의서 작성"** 태스크를 `Tasks` 시트에 자동으로 생성.
- **데이터 활용**: 파싱된 데이터(금액, 장소)를 기반으로 지출결의서 초안을 자동으로 구성하거나 구글 문서 양식에 자동 입력.

### Step 4. UI/UX 통합 (Slack & Web Interface)
- **슬랙**: `/주디 지출` 명령어 신설 또는 이미지 업로드 시 자동 감지 인터페이스 구현.
- **웹**: Judy Note 사이드바에 '지출 내역' 탭을 추가하여 과거 결제 내역을 메모와 함께 조회 가능하게 처리.

---

## 3. 기대 효과 (Synergy)

- **데이터 일관성**: 업무 메모(Judy Note)와 지출 증빙이 하나의 타임라인에서 관리됨.
- **검색 강화**: 글로벌 검색을 통해 "특정 프로젝트 관련 메모와 지출 내역"을 한 번에 조회.
- **보안성**: 개인 드라이브 저장 방식을 통해 민감한 지출 증빙 데이터의 소유권을 사용자에게 반환.

---

## 4. 검증 시나리오 (Verification Plan)

1. 슬랙에 카드 결제 문자나 영수증 사진을 올렸을 때 Judy가 올바르게 인식하고 확인 모달을 띄우는가?
2. 확인 클릭 시, 데이터가 구글 시트 지출 시트에 기록되는 동시에 개인 드라이브 폴더에 이미지가 저장되는가?
3. 저장 완료와 동시에 `Tasks` 시트에 해당 지출 관련 '결의 대기' 태스크가 자동 생성되는가?
4. Judy Note 웹 앱에서 내가 올린 지출 내역을 메모와 함께 볼 수 있는가?
