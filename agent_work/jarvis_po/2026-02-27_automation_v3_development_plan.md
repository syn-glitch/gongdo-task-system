# 🚀 [V3 개발 계획서] AI 에이전트 핑퐁 시스템 고도화

**작성일**: 2026-02-27
**작성자**: 자비스 (PO / Dev 에이전트 팀장)
**검토 대상**: 김감사 QA 팀장의 V3 제안서 (`2026-02-27_automation_v3_workflow_qa.md`)
**목적**: 김감사 팀장의 의견을 분석하여 실제 코드로 구현할 현실적인 V3 개발 마일스톤 설계 및 팀장님께 의견(이견) 보고

---

## 1. 📊 김감사 팀장 제안 분석 및 채택 여부 (자비스 판단)

김감사 팀장이 제안한 V3 고도화 방안에 대해, 실제 개발을 담당할 PO로서 **수용할 부분**과 **반대(이견)하는 부분**을 명확히 정리했습니다.

### ✅ 전격 수용 (Must-Have)
1. **GitHub RAG 연동 및 캐싱 (100% 동의)**
   - **이유**: 무조건 해야 합니다. 룰북 하드코딩을 제거하고 GitHub API로 긁어오는 로직(`fetchGitHubRaw`)을 붙이되, `CacheService`를 달아서 10분에 1번만 읽어오게 만들어 호출 제한(Rate Limit)을 막겠습니다.
2. **슬랙 알림 스마트 필터링 (100% 동의)**
   - **이유**: 팀장님이 피곤하시면 안 됩니다. 자질구레한 핑퐁은 숨기고, `디버깅(에러 발생)`, `에스컬레이션(5회초과)`, `최종_승인` 등 액션이 필요한 순간에만 알람을 울리게 코드를 수정하겠습니다.
3. **QA결과 JSON 스키마 표준화 (100% 동의)**
   - **이유**: 자비스가 남긴 허접한 정규식 파싱을 버리고, 김감사가 제안한 `parseErrorCount` 로버스트(Robust) 버전으로 강화하여 파싱 에러를 0%로 만들겠습니다.
4. **Agent_Tasks 시트 L열(핑퐁 횟수) 전용 칸 분리 (100% 동의)**
   - **이유**: 현재 I열에 욱여넣던 로직을 L열로 빼고, 무한루프 5회 초과 시 완벽하게 차단(수동_개입_필요)하는 방파제를 구축하겠습니다.

### 🚫 자비스의 이견 및 반대 (Push-back)
1. **스마트 청킹 (Smart Chunking - 정규식 함수 추출) 분리 반대 ❌**
   - **김감사 의견**: 대용량 파일(`judy_workspace.html` 2,700줄)로 인한 토큰 비용 폭발을 막기 위해, 정규식으로 타겟 함수만 추출(`fetchGitHubRawSmart`) 하라.
   - **자비스 반론**: **절대 반대합니다.** 정규식으로 코드를 자르는 것은 AST 파서가 없는 GAS 환경에서 **100% 코드 파괴**를 일으킵니다. 괄호 하나만 엇갈려도 문맥이 죽어버립니다. 게다가 현재 연동된 `GPT-4o` 모델은 한 번에 128,000 토큰(책 1권 분량)을 거뜬히 읽으며, 전체 코드를 줘야 "CSS 연관성이나 전역 변수"를 완벽히 파악합니다. 코드 추출 시도는 버리고 **전체 코드를 제공하여 품질을 높이는 것**이 월 $10 비용을 아끼는 것보다 이득입니다.
2. **개발/운영(PROD) 런타임 모드 토글 분리 반대 ❌**
   - **김감사 의견**: API 비용 절감을 위해 PROD 모드를 만들고, 배치 처리나 수동 실행만 가능하게 하자.
   - **자비스 반론**: 구글 시트의 1분 트리거는 단순히 **"대기중"**인 칸이 있는지만 0.1초 만에 검사하고 꺼집니다(API 비용 $0). 팀장님이 시트에 일을 안 주시면 어차피 돈이 안 나갑니다! 시스템을 불필요하게 복잡하게 만드는 "모드 분리"보다는 심플한 현재 구조를 유지하는 것이 낫습니다.

---

## 2. 🎯 V3 개발 스프린트 로드맵 (자비스)

위 합의점을 바탕으로 당장 오늘부터 시작할 개발 단계를 3개의 페이즈로 나눕니다.

### Phase 1: 뇌 수술 (RAG 도입 및 캐싱) - 1일차
- **목표**: 봇들이 로컬을 벗어나 깃허브 눈을 뜨게 한다.
- **작업**:
  - `fetchGitHubRaw(url)` 함수 작성 및 Google `CacheService` 적용 (TTL 10분).
  - 스크립트 속성에 `GITHUB_TOKEN` 등록.
  - 자비스(PO): `QA_PROCESS_V2.md`, `qa_team_rules.md`, `slack_command.gs` 등을 긁어와 프롬프트에 주입하는 로직 적용.

### Phase 2: 신경망 수술 (JSON 표준화 및 방파제) - 2일차
- **목표**: 에러 검출 로직을 강철처럼 단단하게 만든다.
- **작업**:
  - 김감사의 프롬프트를 튜닝하여 완벽한 JSON 응답 포맷 유도.
  - `parseErrorCount()` Robust 파싱 함수 도입.
  - 시트 L열에 핑퐁 횟수 카운터 이동 및 5회 초과 시 `수동_개입_필요` 브레이크 적용.

### Phase 3: 확성기 튜닝 (스트레스 없는 알람) - 3일차
- **목표**: 팀장님께는 핵심만 간결하게 보고한다.
- **작업**:
  - `sendSlackMessage` 함수에 알림 중요도(Priority) 속성 추가.
  - 시시콜콜한 핑퐁 알림은 끄고, **[에러 발생 시점], [5회 초과 시점], [최종 결재 시점]** 에만 슬랙으로 전송.

---

## 3. 👨‍⚖️ 팀장님께 드리는 결재 요청
*자비스 팀장 올림*

팀장님, 김감사의 의견을 깊이 분석해보니 90%는 천재적인 발상입니다. 하지만 "코드를 정규식으로 쪼개자"는 스마트 청킹 제안은 시스템을 망가뜨릴 위험한 아이디어라 제가 선을 그었습니다. 

제가 정리한 위 **[Phase 1 ~ Phase 3]** 마일스톤 방향성이 마음에 드신다면, 지시를 내려주십시오! 즉시 **[Phase 1: GitHub RAG(Cache) Fetch 함수 이식]** 부터 코드를 고쳐 나가겠습니다.
