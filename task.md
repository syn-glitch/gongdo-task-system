# 업무 관리 시스템 로드맵

## 1단계: 기반 구축 - 구글 스프레드시트 데이터베이스 설정 <!-- id: 1 -->
- [x] 시트 구조 정의 (업무, 프로젝트, 팀원) <!-- id: 2 -->
- [x] `Tasks` (업무) 시트 생성 (ID, 상태, 프로젝트, 내용, 담당자, 날짜 등) <!-- id: 3 -->
- [x] `Users` (팀원) 및 `Projects` (프로젝트) 참조 시트 생성 <!-- id: 4 -->
- [x] ID 생성 및 타임스탬프 관리를 위한 기본 Google Apps Script (GAS) 구현 <!-- id: 5 -->

## Git 및 문서 관리 (Phase 1.5) <!-- id: 25 -->
- [x] 프로젝트 파일 및 문서 Git 커밋 <!-- id: 26 -->
- [x] GitHub 원격 저장소 생성 및 푸시 ([링크](https://github.com/syn-glitch/gongdo-task-system)) <!-- id: 27 -->

## 2단계: 슬랙 연동 - 알림 시스템 <!-- id: 6 -->
- [x] 슬랙 앱 생성 및 권한 설정 <!-- id: 7 -->
- [x] 슬랙으로 메시지를 보내기 위한 Incoming Webhook (또는 Bot Token) 설정 <!-- id: 8 -->
- [x] 새 업무 등록 시 슬랙으로 알림을 보내는 GAS 함수 작성 <!-- id: 9 -->
   - [x] 기본 전송 코드 작성
   - [x] 실전용 자동화 코드(DB연동) 작성 및 트리거 설정
   - [x] 데이터 유효성 검사(드롭다운) 적용으로 알림 정확도 향상

## 3단계: 슬랙 연동 - 업무 등록 (양방향) <!-- id: 10 -->
- [x] GAS에서 슬랙 상호작용 페이로드 처리 (doPost 생성) <!-- id: 13 -->
- [x] GAS를 '웹 앱'으로 배포하여 URL 획득 <!-- id: 28 -->
- [x] 슬랙 앱에서 슬래시 커맨드(예: `/주디`) 생성 및 URL 연결 <!-- id: 11 -->
- [x] 상세 업무 입력을 위한 슬랙 모달(Modal) UI 구축 <!-- id: 12 -->
   - 슬랙과 GAS 연동은 추후에 처리 예정 //용남이 직접 추가한 내용


## 4단계: 캘린더 동기화 <!-- id: 14 -->
- [x] GAS에서 캘린더 API 활성화 및 `calendar_sync.gs` 스크립트 작성 <!-- id: 15 -->
- [x] 동기화 로직 구현: 시트 행 업데이트 -> 캘린더 일정 생성/수정 <!-- id: 16 -->
- [x] 일정 삭제 또는 날짜 변경 처리 (상태 변경 반영) <!-- id: 17 -->

## 5단계: AI 리포팅 및 분석 <!-- id: 18 -->
- [x] GAS에서 Claude API 연결 설정 및 `ai_report.gs` 작성 <!-- id: 19 -->
- [x] 일간/주간 완료 업무 데이터를 가져오는 스크립트 작성 <!-- id: 20 -->
- [x] AI를 통한 요약 리포트 생성 및 슬랙 전송 <!-- id: 21 -->

## 6단계: 대시보드 및 최적화 <!-- id: 22 -->
- [x] 구글 스프레드시트 내 시각적 대시보드 및 차트 세팅 가이드 작성 <!-- id: 23 -->
- [x] 매일 아침 전송되는 "모닝 브리핑" 자동화 코드 및 트리거 스위치 구현 <!-- id: 24 -->

## 7단계: 메모장 (Judy Note) UI/UX 고도화 및 AI 요약
- [x] `judy_note.html` CSS 구조 개편 (CSS Variables 도입 및 Light Mode/Dark Mode 지원)
- [x] 좌측 사이드바(폴더 구조) 및 우측 에디터 영역 2단 레이아웃 구현
- [x] `drive_archive.gs`에 아카이브 트리 파싱 백엔드 함수 (`getArchivedMemos`) 추가
- [x] 프론트엔드 연동 및 사이드바 내 폴더 목록 클릭 이벤트 구현 (읽기 모드 전환)
- [x] 메모 조회 영역 상단에 AI 요약 버튼 및 UI 오버레이 구현
- [x] `web_app.gs` 및 AI 로직 (`summarizeMemoContent`) 추가

## 8단계: 🚀 향후 고도화 계획 (Future Enhancements)
- [x] **특정 단어 및 단어 전체 검색 기능 (Global Search)**
  - 모든 마크다운 파일을 순회하여 키워드 매칭 후 사이드바나 에디터에 결과 표출 (AI RAG 통합 로직 기반)
- [x] **슬랙 기반 챗봇 라우팅 및 빠른 검색 (Slack Intent Routing)**
  - 슬랙 봇 DM 수신 시 메시지 의도 판별(기반: 키워드) 로직 추가
  - 메모 단순 저장 시 불필요한 AI 답변(`processAiChatSync`) 완전 차단
  - "오늘 작성 메모 보여줘" 검색 의도시 금일 날짜의 메모를 조회하여 슬랙으로 깔끔하게 반환
- [ ] **에디터 내용 수정 가능 모드 (Edit Mode) & 덮어쓰기 기능**
  - **설명**: 현재 읽기 전용으로 불러와지는 과거 메모를 웹 에디터 안에서 직접 수정하고 저장할 수 있는 기능입니다.
  - **개발 방향**: 드라이브 마크다운 문서 내용을 파싱하여 특정 시간대 블록만 정확히 찾아 교체하고 파일 원본을 덮어쓰는(Update) 안전한 치환 로직 구현이 핵심입니다.
- [ ] **AI 챗봇과의 양방향 인터페이스 (AI Chat & Ask)**
  - **설명**: 단순한 '전체 글 요약' 팝업을 넘어서, 본문 내용 중 특정 구역을 지정하거나 하단 채팅창을 통해 AI와 티키타카(질의응답)를 나눌 수 있는 지능형 워크스페이스 기능입니다.
  - **개발 방향**: 에디터 내 동적 질문 API(`askAi`) 신설 및 노션(Notion)의 AI 블록과 유사한 양방향 채팅 버블 UI를 프론트엔드에 추가 구축해야 합니다.

## [기각됨] 9단계: 동적 유저 관리 및 구글 SSO 보안 강화 (Dynamic User & Auth)
> 💡 **회고 및 기각 사유**: 
> 구글의 `Session.getActiveUser().getEmail()`을 활용한 SSO 인증을 시도했으나, 공도 팀의 **다중 도메인 환경(`@microchool.kr`, `@gongdo.kr`, `@gmail.com`)** 특성상 배포 권한을 외부로 개방해야 했음. 
> 이로 인해 최초 접속 시 발생하는 **구글 Oauth 권한 승인("이 앱이 정보에 접근하려 합니다") 팝업창**이 팀원들에게 상당한 UX 저하와 심리적 장벽을 유발할 것으로 판단되어 해당 접근 방식을 전면 백지화(Rollback) 하였음.

## 10단계: 슬랙 기반 매직 링크 보안 인증 (Slack Magic Link Auth)
> 📖 상세 계획: [`implementation_plan_phase10.md`](implementation_plan_phase10.md)
> 💡 **핵심 원리**: 신원이 이미 100% 보장된 '슬랙'을 인증(SSO) 창구로 역이용. 슬랙봇이 일회용 난수 토큰(Token)을 생성해 전용 만능 키(Magic Link)를 팀원 개인 DM으로 발급함. 구글 권한 팝업 없이 1초 만에 안전하고 완벽한 자동 로그인을 제공함.

### 개발
- [x] **Step 1: 슬랙 봇(`slack_command.gs`) 로직에 매직 링크 발급 기능 신설**
  - 팀원이 슬랙에서 `/주디 노트` 등 특정 액션 시, 봇이 16자리 난수 토큰 생성
  - `CacheService`를 이용해 토큰과 해당 팀원 실명을 **10분(600초)** 동안 단기 캐싱
  - 유저별 `?token=난수값` 형태의 파라미터가 붙은 접속 버튼을 개인 DM으로 전송
- [x] **Step 2: 웹 백엔드(`web_app.gs`)의 토큰 검증 시스템 개발**
  - `doGet(e)`에서 토큰 파라미터 존재 유무 확인
  - 백엔드에 토큰 유효성 검증 API(`validateToken`)를 만들어, 10분 이내의 유효 캐시인지 대조
  - 검증 성공 시 `이름` 반환 후, **보안을 위해 해당 토큰은 즉시 파기(1회용)**
- [x] **Step 3: 웹 프론트엔드(`judy_note.html`) 안전 렌더링 및 UI 방어**
  - 타인 이름 임의 선택 및 메모 열람 가능성이 있던 기존 드롭다운 완전 삭제
  - 토큰 검증에 성공한 본인 이름(Real Name)만 상단에 고정 렌더링
  - 토큰 변조(브루트포스) 및 만료 시 "잘못된 접근입니다" 풀스크린 오버레이 표출

### 검증
- [x] 슬랙봇이 준 링크로 접속 시 로그인 과정 없이 내 이름으로 즉시 노트 로드되는지 확인
- [x] 이미 방문했던 링크의 주소창 토큰 값 복사 후 시크릿 탭에서 붙여넣었을 때 **'만료된 링크' 차단(1회용 소멸)** 확인
- [x] 임의로 URL의 토큰 텍스트를 조작하여 엔터 입력 시 **타인 노트 우회 접속 불가(차단)** 확인

## [기각됨] 11단계: 마크다운 & 위지윅 하이브리드 에디터 도입 (TUI Editor)
> 📖 상세 계획: [`implementation_plan_phase11.md`](implementation_plan_phase11.md)
> 💡 **회고 및 기각 사유**: 심플한 기존 버전으로 롤백 요망.
> **기술적 이유**:
> 1. 모바일 등 다양한 기기에서의 호환성 문제 (TUI 에디터가 화면의 가로/세로 영역을 고정적으로 점유해 사용성 저하)
> 2. 구글 문서(Google Docs) 등 써드파티 문서 연동에 있어서 마크다운 에디터 엔진(TUI)으로 값을 불러와 다시 랜더링 하는 과정에서 원본 텍스트의 형태가 심하게 훼손됨.
> 3. 단순 텍스트 기록장을 원했던 초기의 기획 의도와 달리 지나치게 무겁고 복잡한 위지윅 에디터 방식이 유저 경험(UX)에 오히려 마이너스 요소로 작용함.



### 개발
- [x] **Step 1: 에디터 라이브러리 탑재 및 CSS 레이아웃 개편 (`judy_note.html`)**
  - `<textarea id="memoInput">` 완전 삭제 및 TUI 에디터 컨테이너(`<div id="editor">`) 생성
  - CDN을 통해 TUI 에디터 핵심 라이브러리 및 다크 테마 플러그인 연동
  - `judy_note_theme` 테마(Dark/Light) 변경 버튼과 에디터 내부 스킨(다크모드) 연동
- [x] **Step 2: 에디터 인스턴스 초기화 및 상태 관리 (JS)**
  - 페이지 로딩 시 마크다운+위지윅 탭이 보이는 에디터 뷰 마운트
  - 사이드바 과거 메모 클릭 시 단순 글자 뿌리기가 아닌 `editor.setMarkdown(text)`로 렌더링
  - 구글 드라이브 CORS 한계를 고려하여 이미지 복사/업로드(AddImageBlobHook) 기능 차단 처리 
- [x] **Step 3: 데이터 입출력 파이프라인 연결 연동**
  - 메모 일반 저장(`saveBtn`) 및 AI 추출(`extractBtn`) 시 에디터 내용을 `editor.getMarkdown()`으로 추출하여 백엔드 전송
  - AI 내용 요약(`summarizeBtn`) 시 에디터 본문을 타겟팅 하도록 로직 수정

### 검증
- [ ] 에디터 상단 툴바(굵게, 기울임, 표, 링크 등) 및 하단 탭(마크다운/위지윅) 전환이 정상 작동하는가?
- [ ] 노션처럼 블록 드래그 후 스타일 변경 뒤 저장했을 때, 구글 드라이브에 `.md` 원본 포맷으로 저장되는가?
- [ ] "✨ AI 내용 요약" 및 "✨ AI 업무 추출" 기능 사용 시 에디터에 적힌 내용이 백엔드로 정상 전달되는가?

## 12단계: 주디 노트 에디터 심플 버전 롤백 및 구글 문서 연동
> 📖 상세 계획: [`implementation_plan.md`](../../../.gemini/antigravity/brain/4b6fdd0e-4194-4fd1-b05a-0c007c5462e3/implementation_plan.md)
> 💡 **목표**: TUI 에디터를 제거하고 기존의 심플한 텍스트 에어리어로 복구하며, 구글 드라이브(MD 파일) 및 구글 문서(Doc) 모두에 기록 가능하도록 파싱 로직을 확장합니다.

- [x] `judy_note.html`에서 TUI 에디터 제거 후 심플 텍스트 에어리어 복구
- [x] `drive_archive.gs`에서 기존 `.md` 파일 파싱 외에 구글 문서(`application/vnd.google-apps.document`)에 저장된 내용도 동일하게 읽어올 수 있도록 수정
- [x] 주디 노트 폴더 클릭 시 구글 문서에 저장된 노트 버전 내역도 뷰어에 정상 출력되는지 확인

## 13단계: 모바일 반응형 디자인 (UI/UX) 최적화
- [x] 오프캔버스(Off-canvas) 방식 사이드바 구현 (`max-width: 768px`)
- [x] 헤더 영역 햄버거 메뉴 및 배경 반투명 오버레이 처리
- [x] 폴더 내 아이템 열람 및 '새 메모' 작성 시 모바일 사이드바 자동 닫기 편의 기능 추가
- [x] 모바일 사용성을 위해 하단 버튼 패딩 확대 및 단축키 힌트 숨김 처리
