# 11단계 Implementation Plan: 마크다운 & 위지윅 하이브리드 에디터 도입 (TUI Editor)

> **최종 작성일**: 2026-02-22  
> **목표**: 비전공자(노션 친화적)와 개발자(마크다운 친화적)를 모두 만족시키는 강력한 문서 타이핑 경험 제공

---

## 1. 개요 및 기술 스택
기존의 단순 `<textarea>` 입력 방식을 폐기하고, NHN에서 오픈소스로 제공하는 **[Toast UI Editor (TUI Editor)](https://ui.toast.com/tui-editor)** 엔진을 `judy_note.html`에 탑재합니다.

- **지원 모드**: 
  - `Markdown 모드`: 좌측에 코드를 작성하면 우측에 실시간 렌더링 화면을 보여주는 옵시디언/깃허브 스타일
  - `WYSIWYG 모드`: 워드나 노션처럼 상단 버튼을 눌러 서식을 즉시 적용하는 직관적인 스타일
- **호환성**:
  - 기존 구글 드라이브 백엔드 로직(`drive_archive.gs`)을 **단 1줄도 수정하지 않습니다.** 
  - 에디터에서 작성 완료 후 `editor.getMarkdown()` 함수를 호출해 순수 마크다운 순정 텍스트로만 서버에 전송합니다.

---

## 2. 개발 상세 단계 (Step-by-Step)

### Step 1: 라이브러리 연동 및 에디터 마운트 UI 구성 (`judy_note.html`)
1. TUI Editor 핵심 CSS(`toastui-editor.min.css`)와 JS 라이브러리 CDN을 HTML `<head>`와 `<body>`에 추가.
2. 현재의 `<textarea id="memoInput">` 엘리먼트를 아예 삭제하고, 그 자리에 `<div id="editorContainer"></div>` 형태의 마운트 지점 생성.
3. 에디터가 화면 중앙부를 가득 채우도록 레이아웃(Flex/Height) 및 CSS 스타일 세부 조정. 
4. 테마(Dark/Light) 전환 시 에디터 내부 스킨도 함께 변경되도록 TUI Dark 테마 연동.

### Step 2: 에디터 인스턴스 초기화 및 상태 관리 JS 연동
1. 자바스크립트 최하단에 에디터를 생성하는 초기화 로직 작성. 기본 모드는 `마크다운`으로 하되 하단 탭으로 자유롭게 전환 가능하도록 옵션(`initialEditType: 'markdown'`) 설정.
2. 불필요한 이미지 업로드 기능 핫픽스 (구글 드라이브 호스팅 한계 대응):
   - 이미지 복사/붙여넣기(`addHook('addImageBlobHook')`) 기능을 가로채어, 서버로 전송하지 않고 일단 동작을 막거나 텍스트로 안내하는 방어 로직 추가.
3. 기존 작성 중이던 메모를 클릭(수정 모드 진입)했을 때, 서버에서 받아온 쌩 텍스트를 `editor.setMarkdown(text)`로 밀어넣어 예쁘게 렌더링되도록 뷰어(또는 에디터) 전환 로직 수정.

### Step 3: 저장 파이프라인(Save/AI Extract) 연결
1. 기존 `saveBtn`(일반 저장) 클릭 시, `memoInput.value` 대신 `editor.getMarkdown()` 값을 낚아채어 백엔드로 전송.
2. 기존 `extractBtn`(AI 업무 추출) 클릭 시에도 동일하게 `editor.getMarkdown()` 값을 전송.
3. `summarizeBtn`(요약 기능) 역시 에디터 본문을 읽도록 연동.

---

## 3. 검증 시나리오 (Verification Plan)
- [ ] 브라우저 로딩 시 TUI 에디터가 정상적으로 뜨고 툴바(B, I, 표, 링크 등)가 보이는가?
- [ ] 마크다운 탭과 위지윅 탭 전환이 부드럽게 이루어지는가?
- [ ] 노션처럼 블록을 드래그하여 글씨 굵기를 바꾸고 저장했을 때, 드라이브에 `**굵은글씨**` 형태로 원본 훼손 없이 들어가는가?
- [ ] [다크 모드/라이트 모드] 버튼 클릭 시 에디터 내부 바탕색도 알맞게 전환되는가?
- [ ] 과거 사이드바의 메모 클릭 시 에디터에 마크다운이 적용된 형태로 글씨가 잘 표시되는가?

---

## 4. 제약 사항
- 구글 앱스 스크립트 특성상, 로컬 컴퓨터에 있는 이미지를 에디터에 `Ctrl+v`로 붙여넣어 서버(구글 드라이브)로 업로드하는 기능은 이번 페이즈에서 **지원하지 않습니다.** (외부 이미지의 URL 링크 삽입만 지원). 추후 스토리지 Hook 개발 시 단계적으로 확장.
