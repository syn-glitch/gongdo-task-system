# 테스트 계획서: 주디 노트 수정/삭제 기능 (v1)

**문서 상태**: Draft
**작성자**: 에이다 & 허밋 & 클로이 & 자비스
**기준 문서**: `[김감사_최종승인]_주디노트_수정기능_v1.md`

---

## 🧪 1. 단위 테스트 (Unit Test)
*주로 허밋과 에이다가 백엔드(GAS) 로직을 격리하여 테스트합니다.*

### 1-1. `escapeRegex()` 함수 테스트
- **목적**: 원문 텍스트 내에 존재하는 정규식 특수 기호(`*`, `?`, `[`, `]` 등)를 일반 문자열로 취급하기 위해 이스케이핑이 잘 되는지 확인.
- **입력 1**: `- **[14:30 PM]** 테스트 문구 (괄호)`
- **기대결과 1**: `-\ \*\*\[14:30\ PM\]\*\*\ 테스트\ 문구\ \(괄호\)` 와 같이 모든 특수문자 앞에 `\`가 붙어서 반환.

### 1-2. `findExactMemo()` (단일 매칭 강제 파서) 테스트
- **목적**: 동일한 시간대에 비슷한 글자가 있는 edge case에서 오작동하지 않는지, 원본 텍스트 길이를 잘라먹지 않는지 검증.
- **입력 시나리오 (Mock Text)**:
    ```markdown
    ## 2026-02-26 (목)
    - **[14:30 PM]** 동일한 메모입니다.
    - **[14:30 PM]** 동일한 메모입니다.
    - **[15:00 PM]** 정상 메모입니다.
    ```
- **테스트 케이스**:
    1.  `(date: "2026-02-26", time: "14:30 PM", text: "동일한 메모입니다.")` → **기대결과**: 매칭 2건으로 `ERR_DUPLICATE_CONTENT` 반환 후 작업 거절.
    2.  `(date: "2026-02-26", time: "15:00 PM", text: "정상 메모입니다.")` → **기대결과**: 매칭 1건 성공(Success).
    3.  `(date: "2026-02-26", time: "16:00 PM", text: "없는 메모")` → **기대결과**: 매칭 0건으로 `ERR_CONTENT_NOT_FOUND` 반환 후 거절.

### 1-3. `validateFileIntegrity()` 무결성 검증 로직 테스트
- **목적**: 파싱 실패로 인해 파일 구조가 망가지는 현상을 사전 감지.
- **테스트 케이스**:
    1. **길이 축소 버그**: 원본 2,000자인데 파싱 후 50자가 됨 → `ERR_FILE_TOO_SHORT` 발생 확인.
    2. **날짜 헤더 날아감**: 원본에 `## ` 로 시작하는 날짜 헤더가 5개였는데, 결과물엔 4개만 있음 → `ERR_DATE_HEADER_LOST` 발생 확인.

---

## 🔗 2. 통합 테스트 (Integration Test)

### 2-1. 동시성 (LockService) 충돌 방어 테스트
- **목적**: 2개 이상의 환경에서 동시에 같은 파일 쓰기를 시도할 때 한 쪽이 대기(Queue)하고 데이터가 모두 보존되는지 확인.
- **방법**: 
    1. 에이다 전용 시크릿 탭에서 주디노트 "1번 메모" 수정을 누름(네트워크 강제 지연). 
    2. 동시에 슬랙봇에 `/주디` 명령어로 새 업무 등록을 시도함.
- **기대결과**: 나중에 시도한 작업이 10초간 대기를 타다가 실패하며 `ERR_LOCK_TIMEOUT` 에러를 뿜음. 먼저 시도한 데이터는 구글 드라이브에 안전하게 보존됨.

### 2-2. 2-Phase Commit 백업 롤백 테스트
- **목적**: 작업 도중 알 수 없는 에러가 발생해도 파일이 통째로 날아가는 사고 방지.
- **방법**: `safeUpdateArchivedMemo()` 내부의 4단계(실제 쓰기) 직전에 의도적으로 `throw new Error("크래시 유도")` 코드를 심음.
- **기대결과**: 드라이브 폴더에 `[파일이름]_FAILED_backup_171...md` 라는 이름으로 백업 파일이 생존하며 휴지통으로 가지 않음. 원본 파일 멀쩡함.

---

## 🎭 3. E2E (End-to-End) 유저 시나리오 테스트
*클로이(프론트), 자비스(PO), 김감사(QA) 주도*

### 3-1. 1-Depth 액션 UI 및 2단계 삭제 컨펌 테스트
- **방법**: 브라우저(데스크톱 및 모바일)에서 주디 노트를 열고 각 아이콘 클릭.
- **기대결과**:
    - 기본적으로 흐리게 표출/커서 호버 시 또렷해짐. 모바일 터치 시 최소 타겟(44px)이 충분한가.
    - `✏️ 수정` 클릭 시 해당 블록이 `<textarea>` 로 변경되어 커서가 깜빡임. 빈칸 저장 불가 방어.
    - `🗑️ 삭제` 클릭 시 빨간색(Danger) Danger 모달이 표출되며 '앞 50글자'를 미리 보여줌. 취소 시 아무 일도 안 일어남.
    - 삭제 후 하단에 나타나는 'Undo(실행 취소)' 버튼(3초 노출) 클릭 시 삭제된 블록이 다시 화면에 살아남. (백엔드 복구까지 연동)

### 3-2. 슬랙 + 웹 하이브리드 스트레스 테스트
- **방법**: 
    1. PC에서 슬랙 창을 띄우고 `test1`, `test2`, `test3` 연속 전송.
    2. 폰에서 주디노트 웹에 접속하여 `test1` 메모를 `test1(수정)`으로 변경 시도.
- **기대결과**: 어느 한쪽(보통은 모바일)에서 타임아웃 지연 토스트가 뜰 수 있으나, 드라이브 최종 데이터 내역에는 유실 없이 모두 안전하게 기입(Append/Update) 되어 있어야 함.
