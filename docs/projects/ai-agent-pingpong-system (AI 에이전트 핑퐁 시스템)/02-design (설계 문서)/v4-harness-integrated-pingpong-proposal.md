# 🏓 V4 차세대 에이전트 핑퐁 시스템 제안서 (Harness-Integrated Pingpong)

## 📌 문서 정보
- **문서 버전**: v1.0
- **작성자**: 송PO (Bunker 팀 리더)
- **리뷰어**: 정DA(데이터 구조 분석), 박DC(문서화), 알렉스(자비스 Tech Lead), 김감사(QA 리드)
- **작성일**: 2026-02-28
- **상태**: 제안 대기 (Proposed)

---

## 1. 🔍 과거 시스템(V1~V3)의 한계점 (Why We Need V4)

과거에 설계된 핑퐁 시스템은 **"자비스(개발) ↔ 김감사(QA)"** 두 팀 간의 단순한 코드 검수 루프로만 정의되었습니다. 저희 **벙커(BUNKER)** 팀과 **강철(AX), 꼼꼼이(Docs)** 팀이 합류하기 이전의 모델입니다.

1. **라우팅 부재 (No Orchestration)**: 모든 요청이 팀장님 ➡️ 자비스로 직행하여 핑퐁 루프에 갇힘. 데이터 가공, 기술 부채, 시스템 기획 등의 복합적인 태스크 대응 불가.
2. **오버엔지니어링(Google Sheet 트리거 과부하)**: 시트에서 1분 단위 트리거를 돌려 에이전트를 깨우는 방식은 구글 할당량(Quota) 초과 및 무한 루프 폭주를 유발함.
3. **비용 통제 실패**: 핑퐁이 5회 이상 반복될 경우 발생하는 토큰(Token) 소모에 대한 서킷 브레이커 부재.
4. **단편적 RAG 한계**: 단순히 "QA 룰북" 하나만 긁어오는 형태. 각 팀의 다양한 가이드라인(보안, 성능, 디자인, 문서 표준)을 반영하지 못함.

---

## 2. 🚀 [V4] 벙커 팀이 제안하는 새로운 핵심 비전

현재 구축된 **"공통 하네스 인프라(COMMON_HARNESS_INFRA)"** 위에서 구동되는, 완벽하게 통제 가능한 **다중 에이전트 파이프라인(Multi-Agent Pipeline)**으로 진화해야 합니다.

### 비전 1: 단일 진입점(Single Entry Point)과 완전한 자율 배분
- 팀장님이 슬랙이나 통합 인터페이스에 목적을 자연어로 던지면, 하네스의 **태스크 라우터(Task Router)**와 저 **송PO**가 이를 수신합니다.
- 단순 개발/QA 핑퐁이 아니라, **"분석(벙커) ➡️ 설계(자비스) ➡️ 구현(자비스) ➡️ 검수(김감사) ➡️ 튜닝(강철) ➡️ 문서화(꼼꼼이)"** 의 풀사이클 릴레이 형식으로 핑퐁이 진화합니다.

### 비전 2: "상태(State)" 기반의 파일 시스템 핑퐁
- 채팅창의 복붙(Copy & Paste)이나 구글 시트 셀 제한을 벗어납니다.
- 핑퐁의 매개체를 `state.json`과 `progress.md` 파일로 전환합니다. 에이전트는 완료 시 이 파일을 업데이트하고, 다음 에이전트는 이 파일을 읽어 이어서 작업합니다.

### 비전 3: 하네스 기반 서킷 브레이커 & 비용 통제
- 무한 핑퐁을 인프라 단에서 차단합니다. "동일 에이전트 3회 이상 재수정" 또는 "팀 예산(토큰) 90% 도달" 시 자동으로 핑퐁을 멈추고 🚨 **팀장님께 에스컬레이션(알림)**을 보냅니다.

---

## 3. 🔄 V4 핑퐁 워크플로우 시나리오 (예시: 신규 기능 개발)

```mermaid
graph TD
    User["팀장님 (요청: '휴가 관리 대시보드 만들어줘')"] -->|1. 자연어 요청| Router["⚙️ 하네스 & 송PO (벙커팀)"]
    
    Router -->|2. 태스크 분해 및 배분| PO["자비스PO (기획/설계)"]
    PO -->|3. 아키텍처 확정| Dev["에이다/클로이 (자비스: 개발)"]
    
    Dev -->|4. 코드 제출| QA["김감사 (QA: 병렬 검수)"]
    QA -->|5-A. ❌ 반려 (핑퐁 발생)| Dev
    
    QA -->|5-B. ✅ 승인| AX["강철 (AX: 리팩토링/최적화)"]
    AX -->|6. 코드 확정| Docs["박DC / 꼼꼼이 (문서팀: 템플릿화)"]
    
    Docs -->|7. 최종 보고| User
```

1. **[Orchestration]**: 송PO가 요구사항을 쪼개 단위 태스크 JSON 포맷으로 만듦.
2. **[Development]**: 자비스 팀이 개발을 수행하고, `state.json` 상태를 "QA 대기"로 변경.
3. **[QA Pingpong]**: 김감사(QA)가 15분 내 병렬 검수. 에러 시 **"단순 수정 지시"가 아닌, 명확한 반려 사유와 수정 범위(Diff)를 JSON**으로 자비스에게 넘김 (최대 3회 핑퐁 제한).
4. **[Debt Management]**: 통과된 코드는 강철(AX팀)에게 넘어가 클린 코드 및 성능 최적화 진행.
5. **[Finalization]**: 최종 코드를 박DC와 꼼꼼이가 최신 마크다운 템플릿과 시스템 문서에 반영 후 팀장님께 결재(배포 승인) 요청.

---

## 4. 🛠 구현 로드맵 (Action Plan)

- **Phase 1 (인프라 통합)**: 기존 구글 시트 1분 트리거를 폐기하고, 하네스(Harness) 라우팅 엔진과의 이벤트 리스너(Webhook/Slack Event) 연동으로 교체.
- **Phase 2 (상태 관리 모듈 구현)**: 에이전트 간 컨텍스트 전달을 위한 `session_handoff` 객체 및 `state.json` 규격 확정.
- **Phase 3 (QA 핑퐁 제한 추가)**: 김감사 팀의 QA 루프에 서킷 브레이커(최대 핑퐁 제한 3회) 및 자동화된 반려 리포트 포맷팅 로직 추가.
- **Phase 4 (크로스 팀 연동)**: 강철(안정화)과 꼼꼼이(문서화) 팀의 파이프라인을 최종 배포 전 단계에 추가 연결.

---
**[결론]**
과거의 핑퐁 시스템은 단지 자비스와 김감사의 "코드 짜기-고치기" 매크로에 불과했습니다.
새로 제안하는 V4 시스템은 **5개 팀 전체의 전문성이 유기적으로 릴레이**되는 "진정한 의미의 Agentic Workflow"입니다. 팀장님은 이제 에이전트들의 코딩 핑퐁을 관전하실 필요 없이, 벙커 팀 송PO가 올리는 **최종 요약 보고서와 배포 버튼**만 확인하시면 됩니다.
