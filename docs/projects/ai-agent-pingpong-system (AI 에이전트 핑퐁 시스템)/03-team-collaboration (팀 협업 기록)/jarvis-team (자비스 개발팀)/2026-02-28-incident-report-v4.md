# 📋 [보고서] V4 통합 시스템 테스트 오류 분석 및 조치 현황

**수신**: 김감사(QA 팀장) 및 하네스 운영팀
**발신**: 자비스 개발팀 (송PO / 알렉스)
**일시**: 2026-02-28 22:15
**주제**: V4 핑퐁 시스템 연동 테스트 중 발생한 이상 현상 원인 파악 및 조치 결과 리포트

---

## 1. 개요
최근 V4 핑퐁 시스템(하네스 통합형) 배포 후, 김감사 팀의 QA 반려 데이터를 모의 전송하는 과정에서 다음과 같은 세 가지 주요 이상 현상이 발견되어 분석을 진행하였습니다.

## 2. 이상 현상 분석 및 원인

### ① 슬랙 에러 메시지: `lock.release is not a function`
- **원인**: Google Apps Script(GAS)의 `LockService` API 명령어 오기입. `releaseLock()`을 사용해야 하나 `release()`로 오타가 발생하여 스크립트 실행이 중단됨.
- **조치**: 스크립트 내 해당 명령어를 `lock.releaseLock()`으로 긴급 수정 완료.

### ② 슬랙 알림: `[서킷 브레이커 발동] 핑퐁 한계 초과 (3/4/5회)`
- **원인**: 
    1. 동일한 `Task_ID`로 반복적인 모의 반려 테스트 수행 중 안전 장치가 작동함.
    2. 시스템은 `ESCALATED`(중단) 상태로 변경되었으나, 외부 테스트기(Webhook)에서 강제로 "반려" 액션을 계속 주입할 경우, 시스템 로직상 새로운 명령을 우선 처리한 뒤 다시 서킷 브레이커가 발동되는 과정에서 알림이 중복 발생함.
- **분석**: 이는 시스템 오류가 아닌, **안전 장치가 설계된 대로 정상 작동**하고 있음을 의미함.

### ③ 구글 시트 업데이트 미발생 (데이터 확인 불가)
- **원인**: 현재 운영 중인 `Agent_Tasks` 구글 시트의 **모든 행이 삭제되어 비어있는 상태**임.
- **상세**: V4 시스템은 시트의 **A열(Task_ID)**에서 일치하는 번호를 찾아 해당 행을 업데이트하도록 설계되어 있음. 현재 시트에 검색 대상이 없으므로 시스템이 업데이트할 대상을 찾지 못하고 무시됨.
- **웹훅 코드 삭제 관련**: 기존 구형 코드(`github_to_sheet_webhook`) 삭제는 신규 V4 시스템과의 `doPost` 충돌(가로채기)을 막기 위한 **필수적인 조치**였으며, 현재 발생하는 문제와는 관계가 없음. (오히려 삭제함으로써 V4 시스템이 정상적으로 동작하기 시작함)

---

## 3. 향후 조치 및 가이드

1. **시트 데이터 복구**: 테스트를 위해 구글 시트 A열에 실제 존재하는 `Task_ID`(예: `20260228-214431`)를 한 줄이라도 생성해야 합니다.
2. **신규 태스크 테스트**: 횟수가 초과된 기존 ID 대신, 새로운 ID를 생성하여 1회부터 정상적으로 핑퐁이 올라가는지 확인이 필요합니다.
3. **시스템 최적화**: 시트에 행이 없을 경우 자동으로 새 행을 추가하여 기록을 남기는 "자동 행 생성(Auto-Append)" 기능을 V4 업데이트 사양에 추가할 검토 중입니다.

---
**자비스 개발팀은 김감사 QA 팀의 원활한 업무 연동을 위해 인프라 안정을 최우선으로 지원하겠습니다.**
