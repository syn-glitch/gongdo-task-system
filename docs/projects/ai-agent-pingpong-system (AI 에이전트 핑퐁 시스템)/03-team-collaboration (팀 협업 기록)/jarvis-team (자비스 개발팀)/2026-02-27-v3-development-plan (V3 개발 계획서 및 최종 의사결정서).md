# 🚀 [V3 개발 계획서 & 최종 의사결정서] AI 에이전트 핑퐁 시스템 고도화

**작성일**: 2026-02-27
**작성자**: 자비스 (PO / Dev 에이전트 팀장)
**최종 결재자**: 팀장님 (Human PM)
**검토 대상**: 김감사 QA 팀장의 V3 제안서 (`2026-02-27_automation_v3_workflow_qa.md`)
**목적**: 김감사 팀장의 V3 제안서에 대한 자비스의 기술적 분석 및 팀장님의 최종 의사결정 내역을 문서화하여, 명확한 개발 마일스톤 확립.

---

## 1. 📊 김감사 제안 분석 및 팀장님 최종 의사결정 (Decision Log)

김감사가 제안한 6가지 핵심 고도화 방안에 대하여, 자비스 팀장의 기술적 반론(Push-back)과 팀장님의 최종 합의안을 기록합니다.

### ✅ 전격 수용 및 개발 확정 (Must-Have)
1. **GitHub RAG 연동 및 API 캐싱 (수용)**
   - **김감사 제안**: 룰북을 하드코딩하지 말고 GitHub 원본을 읽되, Rate Limit 방어를 위해 10분 캐싱 필수.
   - **자비스 의견**: 100% 동의. `fetchGitHubRaw` 함수에 `CacheService` 결합하여 구현.
   - **팀장님 결정**: **승인 (진행)**
   
2. **무한 핑퐁 5회 차단 방파제 (수용)**
   - **김감사 제안**: Agent_Tasks 시트에 L열(핑퐁_횟수)을 신설하고, 5회 초과 시 에스컬레이션.
   - **자비스 의견**: 100% 동의. 무한 비용 지출 방지를 위한 핵심 안전장치로 구현.
   - **팀장님 결정**: **승인 (진행)**

3. **QA결과 JSON 스키마 표준화 (수용)**
   - **김감사 제안**: 정규식 파싱의 한계를 넘기 위해 Robust 파싱 함수(`parseErrorCount`) 및 명확한 프롬프트 포맷 규정.
   - **자비스 의견**: 100% 동의. 검수 에러를 0%로 만들기 위한 필수 작업.
   - **팀장님 결정**: **승인 (진행)**

4. **슬랙 알림 스마트 필터링 (수용)**
   - **김감사 제안**: 모든 상태 변화를 중계하지 말고, `에러 발생`, `에스컬레이션`, `최종 승인` 시에만 선별 발송.
   - **자비스 의견**: 100% 동의. 알림 피로도 최소화.
   - **팀장님 결정**: **승인 (진행)**

### 🚫 기각 (팀장님 최종 반려 결정)
1. **스마트 청킹 (Smart Chunking - 정규식 기반 일부 코드 함수 추출) ❌**
   - **김감사 제안**: 2,700줄이 넘는 프론트엔드 코드(judy_workspace.html)의 토큰 절약을 위해 타겟 함수만 정규식으로 잘라서 읽혀라.
   - **자비스 반론**: 가장 위험한 발상. GPT-4o는 128k 토큰 문맥을 소화 가능함. 정규식 절삭은 전역 변수나 연관된 CSS 로직 컨텍스트를 파괴하므로 100% 버그 코드를 유발함. 월 $10 비용을 아끼려 코드를 망칠 수 없음.
   - **팀장님 결정**: **자비스 의견 동의. (전체 코드 Context 유지로 기각)**

2. **개발(DEV)/운영(PROD) 런타임 모드 토글 분리 ❌**
   - **김감사 제안**: API 비용 방어를 위해 스크립트 속성을 분리하여 수동 실행(배치) 모드를 도입하라.
   - **자비스 반론**: 현재 1분 트리거는 큐(시트)가 비어있으면 0.1초 만에 종료되어 리소스를 먹지 않음. 굳이 아키텍처를 이중화할 실익이 제로임.
   - **팀장님 결정**: **자비스 의견 동의. (현행 1분 심플 트리거 유지로 기각)**

---

## 2. 🎯 V3 개발 스프린트 로드맵 (자비스 집도)

팀장님께서 합의해 주신 사항을 바탕으로, 오늘 즉시 아래 3개의 페이즈에 걸쳐 `agent_sync.gs` 수술을 단행합니다.

### Phase 1: 뇌 수술 (GitHub RAG 연동) - 📍 당면 목표
- **작업 내용**:
  - `fetchGitHubRaw(repoPath)` 함수 작성 및 Google `CacheService` 적용 (TTL 10분).
  - 스크립트 속성에 `GITHUB_TOKEN` 등록.
  - 자비스 및 김감사 프롬프트에 `QA_PROCESS_V2.md`, `qa_team_rules.md`, 핵심 소스 코드를 동적으로 긁어와 주입하는 RAG 프로세스 이식.

### Phase 2: 신경망 수술 (JSON 표준화 및 5회 핑퐁 제한)
- **작업 내용**:
  - 김감사의 프롬프트를 튜닝하여 완벽한 JSON 응답 포맷 유도 및 `parseErrorCount()` Robust 파싱 함수 도입.
  - 시트 L열 신설, 핑퐁 카운터 5회 초과 시 루프 브레이크 동작(`수동_개입_필요`).

### Phase 3: 확성기 튜닝 (알림 피로도 최적화)
- **작업 내용**:
  - `sendSlackMessage` 로직 개선 (알림 중요도 평가 조건부 발송).
  - 시시콜콜한 중계는 스킵하고 핵심 이벤트 시점에만 알림 전송.

---
**[팀장님 결재 코멘트]**
- 자비스의 분석이 매우 합리적이므로 스마트 청킹과 런타임 분리 제안은 기각한다.
- 위 확정된 로드맵을 바탕으로 즉시 다음 Phase 1 개발에 착수할 것.
