# 🤖 AI 에이전트 자동화 파이프라인 아키텍처 (Google Sheets Queue 기반)

**작성일**: 2026-02-27
**작성자**: 자비스 (PO / 구현 에이전트)

팀장님의 수작업(복사/붙여넣기)을 완전히 0으로 만들고, 에이전트(자비스 ↔ 김감사) 간의 티키타카를 자동화하기 위한 구글 시트 기반의 칸반 큐(Queue) 아키텍처 명세서입니다.

---

## 1. 🏗 아키텍처 개요

- **중앙 DB (Message Broker)**: 구글 시트 (`Agent_Tasks` 탭)
- **에이전트 1 (자비스)**: `PO` & `Developer` 역할. 요구사항을 읽어 코드를 짜고 상태를 `QA_대기`로 넘김.
- **에이전트 2 (김감사)**: `QA Inspector` 역할. `QA_대기` 상태의 코드를 가져와 버그를 찾고 `수정_요청` 또는 `배포_승인`으로 넘김.
- **트리거(Trigger)**: Google Apps Script의 시간 기반 트리거(1분)가 시트 상태를 감시하여, 대상 에이전트에게 백그라운드로 프롬프트 API(예: Cursor, Claude API 등) 콜을 날리거나, 개발 중인 에디터 내부의 에이전트에게 신호를 보냄.

---

## 2. 📊 구글 시트 구조 (Agent_Tasks 탭 생성 필요)

팀장님께서 현재 공도 업무 관리 구글 스프레드시트에 새 탭을 하나 만들어주셔야 합니다. (이름: `Agent_Tasks`)

| 열(Column) | 제목 (Header) | 설명 / 예시 데이터 |
|---|---|---|
| **A** | Task ID | AGENT-001 (자동 생성) |
| **B** | 상태 (Status) | `대기` / `개발중(자비스)` / `QA대기` / `QA중(김감사)` / `수정요청` / `배포준비완료` |
| **C** | 생성자 (Author) | 팀장님 |
| **D** | 요구사항 (Request) | "슬랙 모달 에러 2.0 기획서대로 고쳐줘" |
| **E** | 개발 문서 링크 / 파일 경로 | `agent_work/jarvis_po/2026-02-27_slack_modal_v3.gs` |
| **F** | QA 리포트 링크 / 피드백 | "3번 라인 캐시 미스 에러 발견. 수정 요망" |
| **G** | 현재 소유권 (Owner) | Jarvis ➡️ Kim Gamsa ➡️ 팀장님 |
| **H** | 수정일시 | 2026-02-27 15:30:00 |

---

## 3. 🔄 에이전트 상태 머신 워크플로우 (State Machine)

1. **[대기]**: 팀장님이 B열을 `대기`, D열에 요구사항을 적고 G열을 `Jarvis`로 지정.
2. **[개발중]**: 자비스가 시트를 읽고 작업을 시작. 상태를 `개발중(자비스)`로 변경.
3. **[QA대기]**: 자비스가 로컬 파일에 코드를 스핏(Spit)하고, E열에 파일 경로를 적은 뒤 상태를 `QA대기`, 소유권을 `Kim Gamsa`로 넘김.
4. **[QA중]**: 김감사가 시트의 `QA대기`를 감지. E열의 코드를 읽고 분석 시작. 상태를 `QA중(김감사)`로 바꿈.
5. **[판정 - 수정요청]**: 김감사가 버그를 찾으면 F열에 내용을 적고 상태를 `수정요청`, 소유권은 다시 `Jarvis`에게 토스. (2번으로 돌아가서 핑퐁 반복)
6. **[판정 - 배포승인]**: 김감사가 완벽하다고 판단하면 B열 상태를 `배포준비완료`로 변경하고, **G열 소유권을 `팀장님`**으로 넘기고 슬랙으로 웹훅 알람 전송!

---

## 4. ⚙️ 자동화를 위한 통합 프롬프트 룰셋 제안

이 방식이 완벽히 작동하려면, 팀장님이 저(자비스)와 대화하실 때 **시스템 커스텀 룰(Rules)** 에 아래의 문단을 추가해 두시면 자동화 물레방아가 돌아가기 시작합니다.

```markdown
# Agent Workflow Automation Rule
너(자비스)는 코딩을 완료한 후 사용자에게 "작업이 끝났으니 검토해주세요"라고 말하며 멈추지 마라.
대신 다음 프로세스를 자동 수행하라:
1. 네가 완료한 개발 파일(.gs, .md 등)의 절대 경로를 기억하라.
2. 김감사(QA) 에이전트에게 코드를 검수받기 위해, 구글 시트 'Agent_Tasks'에 접근하여 현재 Task의 상태(Status)를 'QA대기'로 스스로 업데이트하고 네가 짠 파일 경로를 기록하라.
3. (선택적) 만약 네가 직접 커맨드라인에서 다른 스크립트를 트리거할 수 있다면 `npm run trigger-qa` 와 같이 김감사의 봇을 깨우는 명령어를 백그라운드에서 즉시 실행하라.
4. 김감사가 '수정요청' 상태로 시트를 돌려놓으면, 너는 F열의 피드백을 읽고 묻지 않고 즉각 코드를 고친 뒤 다시 'QA대기'로 던져라.
```

---

## 5. 팀장님 첫 번째 Action Item (To-Do)

이 거대한 톱니바퀴를 맞물리게 하기 위해, 첫 번째 기반 공사가 필요합니다.

1. **구글 시트 세팅**: 주디 구글 시트 들어가셔서 새로운 탭 `Agent_Tasks` 리스트를 하나 생성하시고, 위 2번 항목의 A~H열 헤더를 똑같이 적어주세요.
2. **GAS 스크립트 트리거 작성**: 제가 시트와 슬랙, 그리고 자비스/김감사를 이어주는 **관제탑용 `agent_sync.gs` 코드** 하나를 빠르게 짤 수 있도록 승인을 내려주세요.
